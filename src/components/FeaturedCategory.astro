---
import { getCollection } from "astro:content";
import CardList from "./CardList.astro";
import Card from "./Card.astro";

type Props = {
  category: string;
  title: string;
  count: number;
  showFeatured?: boolean;
};

const { category, title, count, showFeatured = false } = Astro.props;

const latestPosts = await getCollection(
  "posts",
  (post) =>
    post.data.draft !== true &&
    post.data.categories?.some((c) => c.id === category)
);
const sortedPosts = latestPosts
  .sort((a, b) => b.data.createdAt.valueOf() - a.data.createdAt.valueOf())
  .slice(0, count);
---

<CardList {title}>
  {
    sortedPosts.map((post, i) => (
      <Card
        title={post.data.title}
        pubDate={post.data.createdAt}
        image={post.data.featuredMedia?.src}
        imageAlt={post.data.featuredMedia?.alt}
        featured={i == 0 && showFeatured}
      />
    ))
  }
</CardList>
